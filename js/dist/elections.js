function toData(t){for(var e,a=[],r=0;r<t.length;r++)e={},e.value=t[r].votes,e.color=getColor(t[r].party),e.label="",t[r].elected&&(e.label+="ELECTED: "),e.label+=t[r].name,a.push(e);return a}function getColor(t){return"Conservative Party"===t?con:"Labour Party"===t?lab:"Liberal Democrats"===t?lib:"Green Party"===t?green:ind}function refresh(t){myNewChart.destroy(),myNewChart=new Chart(ctx).PolarArea(t),$(ctx).height(600),$(ctx).width(600)}function reloadTurnoutChart(){turnoutChart.destroy(),turnoutChart=new Chart(turnoutContext).Bar(turnoutData,turnoutOptions),$(turnoutContext).height(300),$(turnoutContext).height(75)}var lib="#FFC000",con="#0070C0",lab="#FF0000",green="#008000",ind="#808080",candidates=[],turnoutData={labels:[""],datasets:[{label:"",fillColor:"#0070C0",data:[0]}]};$(".wardButton").on("click",function(){console.log("Clicked ward button "+$(this).text());$.ajax({url:"http://data.bathhacked.org/resource/ce47-a7ku.json?$where=year=2011%20AND%20ward=%27"+$(this).text()+"%27",type:"get",dataType:"json",success:function(t){candidates=t,refresh(toData(candidates))},error:function(t,e,a){console.log("ERROR "+a.message)}}),$.ajax({url:"http://data.bathhacked.org/resource/m4j8-2iqf.json?$select=turnout_percentage&$where=year=2011%20AND%20ward=%27"+$(this).text()+"%27",type:"get",dataType:"json",success:function(t){console.log("success"),turnoutData.datasets[0].data[0]=t[0].turnout_percentage,reloadTurnoutChart(),console.log("refreshed")},error:function(){}})});var data=toData(candidates),turnoutOptions={barShowStroke:!1,scaleShowGridLines:!1,scaleOverride:!0,scaleSteps:1,scaleStepWidth:100,scaleStartValue:0,showScale:!1},ctx=document.getElementById("chart1").getContext("2d"),myNewChart=new Chart(ctx).PolarArea(data),turnoutContext=document.getElementById("turnoutChart").getContext("2d"),turnoutChart=new Chart(turnoutContext).Bar(turnoutData,turnoutOptions);